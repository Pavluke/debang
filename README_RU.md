## Debang

[En](README.md) | Ru

Debang — это библиотека для Dart/Flutter, которая помогает документировать и
обрабатывать случаи неожиданных null-значений. Вместо простого использования
оператора `!`, она заставляет разработчика предоставить объяснение (assertion),
почему значение гарантированно не `null`. Это делает ошибки более
информативными, упрощает отладку и повышает качество кода в команде.

### Мотивация

В разработке на Dart/Flutter часто возникают ситуации, когда разработчик уверен,
что значение не может быть `null`, и использует оператор `!` для принудительного
разыменования. Однако со временем контекст может измениться, и это приводит к
ошибкам на продакшене. Библиотека `Debang` решает эту проблему, заставляя
разработчика сразу документировать свои предположения в виде `assertion` —
объяснения, почему значение гарантированно не `null`. Это не только улучшает
отладку, но и повышает качество кода.

Примеры:

1. Разработчик пишет код и ставит `!`, потому что в данный момент уверен в
   логике (например, "значение инициализируется выше"). Через месяц на проде
   падает `NullPointerException`-подобная ошибка. Когда спрашивают автора, он
   отвечает: _"Не помню"_. С `Debang` вместо простого `!` вы используете
   `.debang('Здесь значение
гарантированно не null, потому что оно инициализируется в конструкторе класса')`,
   а это в вою очередь:

   - Заставляет разработчика в момент написания кода задуматься и обосновать
     уверенность.
   - Если обоснование кажется слабым, он может сразу изменить логику, чтобы
     избежать потенциальных проблем.
   - В случае ошибки `assertion` становится "объяснительной запиской", которая
     помогает быстро понять контекст без глубокого копания в историю коммитов.

2. Новый разработчик меняет контекст Новый член команды входит в проект и, не
   зная всех нюансов, удаляет или меняет логику, которая обеспечивала
   инициализацию значения (например, удаляет вызов метода, который заполнял
   переменную). В результате код падает на null. Без Debang ошибка была бы
   общей: "Null check operator used on a null value" — и пришлось бы вручную
   разбираться, что сломалось. С Debang, когда исключение бросается, в логе или
   краш-репорте видно assertion: например, "Значение не null, потому что оно
   всегда устанавливается в методе init()". Это сразу подсказывает:

   - Какая логика была нарушена (ссылка на init() в assertion).
   - Идёшь в код на строку с .debang() и делаешь git blame — видишь
     оригинального автора, который добавил это assumption, и историю изменений.
   - Можно обсудить с вовлечёнными (автором assertion и тем, кто удалил), почему
     логика изменилась, и быстро пофиксить.
   - Это делает код устойчивым к рефакторингу: assertion служит "документацией в
     ошибке", помогая команде быстро локализовать проблему и найти
     ответственных.

## Установка

Добавьте в `pubspec.yaml`:

```yaml
dependencies:
  debang: ^1.0.0
```

Затем выполните:

```bash
dart pub get
```

Или добавьте используя команду:

```bash
dart pub add debang
```

После установки импортируйте библиотеку:

```dart
import 'package:debang/debang.dart';
```

## Использование

```dart
String? maybeNull;
/* 
логика с инициализацией `maybeNull`
которая по мнению разработчика не должна сломаться
но сломалась
*/
final nonNull = maybeNull.debang('Точно не будет null, поскольку инициализировал и обработал все null-ошибки выше');
```

Если `maybeNull` окажется `null`, бросится `Debang` с `assertion`.

```bash
This exception occurred because a `Debang` assertion failed
Assertion: Точно не будет null, поскольку инициализировал и обработал все null-ошибки выше
Expected:  String
Method:    SomeClass.someMethod
File:      some_file.dart:2:27
```

## Настройки

Библиотека имеет глобальные опции в `Debang.options`, которые можно изменить для
кастомизации. По умолчанию они настроены на удобный вывод без лишней
вербозности.

#### Доступные опции

```dart
// Указаны значения по умолчанию
// Так же можно изменить используя `copyWith()`
Debang.options = Debang.options.copyWith(
    showExpected: true,   		// Показывать ожидаемый тип в сообщении об ошибке
    showMethod: true,   		// Показывать имя метода
	showFile: true,				// Показывать файл, строку
	shouldNotifyObservers: true	// Уведомлять observers при создании исключения
    showStackTrace: false,  	// Показывать полный stacktrace
  );
```

## Observers

```dart
class SomeLogger implements DebangObserver {
  @override
  void call(Debang debang) {
    print('Ошибка: ${debang.assertion}, тип: ${debang.expectedType}, файл: ${debang.frame?.file}');
    // Или отправьте в Sentry/Crashlytics
  }
}

// Регистрация
// При `throw Debang()` observer будет вызван
Debang.observers.add(SomeLogger());

// Удаление
Debang.observers.remove(SomeLogger());
```

## Changelog

Список изменений доступен в файле
[CHANGELOG.md](https://github.com/pavluke/debang/blob/main/CHANGELOG.md)

## Contributions

Не стесняйтесь вносить свой вклад в этот проект.

Если вы обнаружили ошибку или хотите добавить новую функцию, но не знаете, как
ее исправить/внедрить, пожалуйста, напишите в
[issues](https://github.com/pavluke/debang/issues). Если вы исправили ошибку или
внедрили какую-либо функцию, пожалуйста, сделайте
[pull request](https://github.com/pavluke/debang/pulls).

## Лицензия

MIT License. Подробности в LICENSE.
